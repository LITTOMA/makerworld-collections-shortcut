name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Create distribution directory
        run: mkdir -p dist

      - name: Package Chrome extension
        run: |
          cd chrome-extension
          zip -r ../dist/makerworld-collection-shortcut-chrome-${{ github.ref_name }}.zip . -x "*.git*"
          cd ..

      - name: Package Firefox extension
        run: |
          cd firefox-extension
          zip -r ../dist/makerworld-collection-shortcut-firefox-${{ github.ref_name }}.zip . -x "*.git*"
          cd ..

      - name: Copy userscript
        run: |
          cp userscript/makerworld-quickfav.user.js dist/makerworld-collection-shortcut-${{ github.ref_name }}.user.js

      - name: Generate checksums
        run: |
          cd dist
          sha256sum * > checksums.txt
          cd ..

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/makerworld-collection-shortcut-chrome-${{ github.ref_name }}.zip
            dist/makerworld-collection-shortcut-firefox-${{ github.ref_name }}.zip
            dist/makerworld-collection-shortcut-${{ github.ref_name }}.user.js
            dist/checksums.txt
          body: |
            ## MakerWorld Collection Shortcut ${{ github.ref_name }}
            
            Add a collection shortcut button in the MakerWorld navigation bar.
            
            åœ¨ MakerWorld å¯¼èˆªæ æ·»åŠ æ”¶è—å¤¹å¿«æ·æŒ‰é’®ã€‚
            
            ---
            
            ### ğŸ“¦ Downloads | ä¸‹è½½
            
            - **Chrome/Edge**: `makerworld-collection-shortcut-chrome-${{ github.ref_name }}.zip`
            - **Firefox**: `makerworld-collection-shortcut-firefox-${{ github.ref_name }}.zip`
            - **Tampermonkey**: `makerworld-collection-shortcut-${{ github.ref_name }}.user.js`
            
            ### ğŸ“– Installation | å®‰è£…æ–¹æ³•
            
            Please refer to [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)
            
            è¯·å‚è€ƒ [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)
            
            ### ğŸŒ Supported Languages | æ”¯æŒçš„è¯­è¨€
            
            English, ä¸­æ–‡, Deutsch, FranÃ§ais, Italiano, EspaÃ±ol, æ—¥æœ¬èª, í•œêµ­ì–´, Svenska, PortuguÃªs
            
            ### âœ¨ Features | åŠŸèƒ½ç‰¹ç‚¹
            
            - Quick access to collections | å¿«é€Ÿè®¿é—®æ”¶è—å¤¹
            - Seamlessly integrated design | å®Œç¾èå…¥åŸç”Ÿè®¾è®¡
            - Multi-language support | å¤šè¯­è¨€æ”¯æŒ
            - Lightweight and fast | è½»é‡å¿«é€Ÿ
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

